<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>JRPG Demo</title>
<style>
  body { margin:0; background:#0b1220; color:#e5e7eb; font-family:system-ui, Segoe UI, Roboto; display:flex; flex-direction:column; align-items:center; }
  header, footer { width:100%; max-width:720px; padding:12px 16px; box-sizing:border-box; }
  header a { color:#e5e7eb; text-decoration:none; border:1px solid #1f2937; padding:6px 10px; border-radius:8px; }
  header a:hover { color:#22d3ee; border-color:#22d3ee; }
  #wrap { border:1px solid #1f2937; background:#0f172a; margin:12px; image-rendering: pixelated; }
  canvas { width:640px; height:480px; display:block; }
  #hud { max-width:640px; color:#cbd5e1; }
  #overlay {
    position:fixed; inset:0; display:none; align-items:center; justify-content:center;
    background:rgba(0,0,0,0.6);
  }
  #battle {
    background:#111827; border:1px solid #1f2937; border-radius:12px; padding:16px; width:min(90%,420px);
  }
  button { background:#0b1220; color:#e5e7eb; border:1px solid #1f2937; padding:8px 12px; border-radius:8px; cursor:pointer; }
  button:hover { border-color:#22d3ee; color:#22d3ee; }
</style>
</head>
<body>
<header><a href="index.html">← Back to Portfolio</a></header>
<div id="wrap"><canvas id="game" width="320" height="240"></canvas></div>
<div id="hud">Arrows to move · Enter near the red enemy to battle · Esc to close menus</div>

<div id="overlay">
  <div id="battle">
    <h3>Battle!</h3>
    <div id="log">A Slime appears.</div>
    <div style="margin-top:10px">
      <button id="attackBtn">Attack</button>
      <button id="healBtn">Heal</button>
      <button id="runBtn">Run</button>
    </div>
  </div>
</div>

<footer>© 2025 JRPG Demo</footer>

<script>
(() => {
  const TILE = 16, W = 20, H = 15; // 320x240 canvas
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');

  const keys = new Set();
  window.addEventListener('keydown', e => { keys.add(e.key); if (e.key === 'Escape') closeBattle(); });
  window.addEventListener('keyup', e => keys.delete(e.key));

  // Simple map: 0 floor, 1 wall
  const map = [];
  for (let y=0;y<H;y++){
    const row = [];
    for (let x=0;x<W;x++){
      const edge = (x===0||y===0||x===W-1||y===H-1);
      row.push(edge ? 1 : 0);
    }
    map.push(row);
  }
  // Add a few internal walls
  for (let x=5;x<15;x++) map[7][x]=1;

  const player = { x: 3, y: 3, color:'#60a5fa', hp: 20, maxhp: 20 };
  const enemy  = { x: 14, y: 10, color:'#ef4444', alive: true, hp: 12, maxhp: 12, name:'Slime' };

  let lastMove = 0;

  function canMove(nx, ny) {
    if (nx<0||ny<0||nx>=W||ny>=H) return false;
    return map[ny][nx] === 0 && !(enemy.alive && enemy.x===nx && enemy.y===ny);
  }

  function update(ts){
    if (ts - lastMove > 100) { // 10 fps movement
      let dx=0, dy=0;
      if (keys.has('ArrowLeft')) dx = -1;
      else if (keys.has('ArrowRight')) dx = 1;
      else if (keys.has('ArrowUp')) dy = -1;
      else if (keys.has('ArrowDown')) dy = 1;

      const nx = player.x + dx, ny = player.y + dy;
      if (dx||dy) {
        if (canMove(nx, ny)) { player.x = nx; player.y = ny; lastMove = ts; }
      }

      if (keys.has('Enter')) {
        if (enemy.alive && Math.abs(player.x-enemy.x)+Math.abs(player.y-enemy.y)===1) {
          openBattle();
        }
      }
    }
    draw();
    requestAnimationFrame(update);
  }

  function draw(){
    // floor
    for (let y=0;y<H;y++){
      for (let x=0;x<W;x++){
        const t = map[y][x];
        ctx.fillStyle = t===1 ? '#1f2937' : '#0b1220';
        ctx.fillRect(x*TILE, y*TILE, TILE, TILE);
        if (t===1){
          ctx.fillStyle = '#111827';
          ctx.fillRect(x*TILE+4, y*TILE+4, TILE-8, TILE-8);
        }
      }
    }
    // enemy
    if (enemy.alive){
      ctx.fillStyle = enemy.color;
      ctx.fillRect(enemy.x*TILE, enemy.y*TILE, TILE, TILE);
    }
    // player
    ctx.fillStyle = player.color;
    ctx.fillRect(player.x*TILE, player.y*TILE, TILE, TILE);

    // player HP bar
    const pw = 100, ph = 6, px = 6, py = 6;
    ctx.fillStyle='#111827'; ctx.fillRect(px-1, py-1, pw+2, ph+2);
    ctx.fillStyle='#ef4444'; ctx.fillRect(px, py, pw*(player.hp/player.maxhp), ph);
  }

  // Battle system (very minimal)
  const overlay = document.getElementById('overlay');
  const log = document.getElementById('log');
  const attackBtn = document.getElementById('attackBtn');
  const healBtn = document.getElementById('healBtn');
  const runBtn = document.getElementById('runBtn');

  function openBattle(){
    overlay.style.display='flex';
    log.textContent = `A ${enemy.name} appears. HP ${enemy.hp}/${enemy.maxhp}`;
  }
  function closeBattle(){ overlay.style.display='none'; }

  function enemyTurn(){
    if (!enemy.alive) return;
    const dmg = 2 + Math.floor(Math.random()*3);
    player.hp = Math.max(0, player.hp - dmg);
    log.textContent += ` | ${enemy.name} hits for ${dmg}. You ${player.hp}/${player.maxhp}.`;
    if (player.hp<=0){ log.textContent += ' Defeated! Press Esc.'; }
  }

  attackBtn.onclick = () => {
    if (!enemy.alive) return;
    const dmg = 3 + Math.floor(Math.random()*4);
    enemy.hp = Math.max(0, enemy.hp - dmg);
    log.textContent = `You strike for ${dmg}. ${enemy.name} ${enemy.hp}/${enemy.maxhp}.`;
    if (enemy.hp<=0){ enemy.alive=false; log.textContent += ' Victory!'; return; }
    enemyTurn();
  };
  healBtn.onclick = () => {
    const amt = 4 + Math.floor(Math.random()*3);
    player.hp = Math.min(player.maxhp, player.hp + amt);
    log.textContent = `You heal ${amt}. ${player.hp}/${player.maxhp}.`;
    enemyTurn();
  };
  runBtn.onclick = () => { log.textContent = 'You ran away.'; closeBattle(); };

  requestAnimationFrame(update);
})();
</script>
</body>
</html>
